
		/*
 * Copyright (C) 2007 Trivantis Corporation
 */

	
function DropZone(x,y,w,h,A,B,C){var D=this;D.x=x;D.y=y;D.w=w;D.h=h;D.dropId=A;D.dragItem=null;D.updateObj=B;D.iMaxDrops=C;D.counter=0;};DropZone.prototype.checkWithinRect=function(A,B){var C=this;var D=A.rtRect.width*transformScale;var E=A.rtRect.height*transformScale;var F=A.rtRect.x*transformScale;var G=A.rtRect.y*transformScale;if(C.updateObj==A.updateObj){if((F+divide(D,2)>=C.x*transformScale&&F+divide(D,2)<=C.x*transformScale+C.w*transformScale)&&(G+divide(E,2)>=C.y*transformScale&&G+divide(E,2)<=C.y*transformScale+C.h*transformScale)) return true;};return false;};function DragMgr(){var A=this;A.item=null;A.arrDragItems=[];A.arrDropZones=[];A.active=false;A.offX=0;A.offY=0;};DragMgr.prototype.onDragDrop=function(){if(this.item.updateObj) this.item.updateObj.questionUpdated();};DragMgr.prototype.addDrag=function(A,B,C){this.arrDragItems[this.arrDragItems.length]=A;A.dragId=B;A.dropObj=null;A.updateObj=C;A.isChoice=true;A.origX=A.rtRect.x;A.origY=A.rtRect.y;A.lyr={ dragId:B };A.checkWithinItem=function(x,y){var D=this.rtRect;var E=false;if(x>=(D.x*transformScale)&&y>=(D.y*transformScale)&&x<=((D.x+D.width)*transformScale)&&y<=((D.y+D.height)*transformScale)) E=true;return E;};A.restoreInit=function(){this.moveTo(this.origX,this.origY);if(this.dropObj){this.dropObj.dragItem=null;this.dropObj=null;}};};DragMgr.prototype.addDrop=function(x,y,w,h,A,f,B){this.arrDropZones[this.arrDropZones.length]=new DropZone(x,y,w,h,A,f,B);};DragMgr.prototype.mouseDown=function(x,y,e){var A=this;var B=getDisplayWindow();for (var i=A.arrDragItems.length-1;i>=0;i--){var C=A.arrDragItems[i];if (C.div.disabled) return false;if ((!!B.TouchEvent&&(e instanceof TouchEvent||isOPAPub())&&e.currentTarget===C.div)||C.checkWithinItem(x,y)){if (!e) var e=B.event;var D=(!!B.TouchEvent&&e instanceof TouchEvent)?C.div:(e.target?e.target:e.srcElement);while(D&&D!==C.div) D=D.parentNode;if(!D) return false;A.item=C;A.offX=(x/transformScale)-A.item.rtRect.x;A.offY=(y/transformScale)-A.item.rtRect.y;if(A.item.dropObj){A.decrementDrop();A.item.dropObj.dragItem=null;A.item.dropObj=null;};A.active=true;break;}};if (!A.active) return false;else return true;};DragMgr.prototype.mouseMove=function(x,y){if (!this.active) return false;else{this.item.moveTo((x/transformScale)-this.offX,(y/transformScale)-this.offY);return true;}};DragMgr.prototype.mouseUp=function(x,y){var A=this;if (!A.active) return false;else{A.active=false;if (!A.checkDrops()) A.item.restoreInit();A.onDragDrop();return true;}};DragMgr.prototype.checkDrops=function(){var A=this.item;for(var B=0;B<2;B++){for (var i=this.arrDropZones.length-1;i>=0;i--){var C=this.arrDropZones[i];if (C.checkWithinRect(A,B)){if(C.counter>=C.iMaxDrops){if (window.reachedMaxDrops) window.reachedMaxDrops(C.iMaxDrops);return false;};C.dragItem=A;A.dropObj=C;C.counter++;if(this.bSnapToCenter) A.moveTo(C.x+divide(C.w,2)-divide(A.rtRect.width,2),C.y+divide(C.h,2)-divide(A.rtRect.height,2));return true;}}};return false;};DragMgr.prototype.decrementDrop=function(){var A=this.item;if(A.dropObj){for (var i=this.arrDropZones.length-1;i>=0;i--){var B=this.arrDropZones[i];if (A.dropObj==B){B.counter--;return;}}}};DragMgr.prototype.setDropById=function(A,B,C){for (var i=this.arrDragItems.length-1;i>=0;i--){var D=this.arrDragItems[i];if(D.dragId==A&&D.updateObj==C){for (var j=this.arrDropZones.length-1;j>=0;j--){var E=this.arrDropZones[j];if (E.dropId==B&&E.updateObj==C){E.dragItem=D;D.dropObj=E;D.moveTo(E.x+divide(E.w,2)-divide(D.rtRect.width,2),E.y+divide(E.h,2)-divide(D.rtRect.height,2));E.counter++;return true;}}}};return false;};DragMgr.prototype.reset=function(A){if (A.disabled) A.disableQuestion(0);trivArExec(A.arChld,function(B){if (B.restoreInit) B.restoreInit();});if (this.arrDropZones) for (var i=this.arrDropZones.length-1;i>=0;i--){if(A==dragMgr.arrDropZones[i].updateObj) this.arrDropZones[i].counter=0;}};DragMgr.prototype.clearDragMouseEvents=function(){var A=getDisplayDocument();A.onmousedown=u;A.onmousemove=u;A.onmouseup=u;if (A.captureEvents) A.captureEvents(0);if(A.body.addEventListener){var B=dragMgr.arrDragItems.length;for (var i=0;i<B;i++){var C=dragMgr.arrDragItems[i].div;C.removeEventListener("touchstart",touchstartHandler);C.removeEventListener("touchmove",touchmoveHandler);C.removeEventListener("touchend",touchendHandler);}}};function initDragMouseEvents(){var A=getDisplayDocument();A.onmousedown=dragMouseDown;A.onmousemove=dragMouseMove;A.onmouseup=dragMouseUp;if (A.captureEvents) A.captureEvents(Event.MOUSEDOWN|Event.MOUSEMOVE|Event.MOUSEUP);if(A.body.addEventListener){var B=dragMgr.arrDragItems.length;for (var i=0;i<B;i++){var C=dragMgr.arrDragItems[i].div;C.addEventListener("touchstart",function(D){touchstartHandler(D);});C.addEventListener("touchmove",function(E){touchmoveHandler(E);});C.addEventListener("touchend",function(F){touchendHandler(F);});}}};function touchstartHandler(A){var B=getDisplayWindow();A=A||B.event;dragMouseDown(A);};function touchmoveHandler(A){var B=getDisplayWindow();A=A||B.event;A.preventDefault();dragMouseMove(A);};function touchendHandler(A){dragMouseUp(A);};function dragMouseDown(e){var A=getDisplayWindow();if (!e) e=A.event;if ((e.which&&e.which!=1)||(is.ie10orLess&&e.button!=0)) return true;var B=getAdjXY(e);if (dragMgr&&dragMgr.mouseDown(B.x,B.y,e)) return false;else return DynMouseDown(B.x,B.y);};function dragMouseMove(e){var A=getDisplayWindow();if (!e) e=A.event;var B=getAdjXY(e);if (dragMgr&&dragMgr.mouseMove(B.x,B.y)) return false;else return DynMouseMove(B.x,B.y);};function dragMouseUp(e){var A=getDisplayWindow();if (!e) e=A.event;var B=getAdjXY(e);if (dragMgr&&dragMgr.mouseUp(B.x,B.y)) return false;else return DynMouseUp(B.x,B.y);};function getAdjXY(e){var A=getDisplayWindow(),B=getDisplayDocument(),C=A.getPagePlayer(),D=C?C.getCurrentPage():n,E=(!!A.TouchEvent&&e instanceof TouchEvent),F=(E||(isOPAPub()&&e.changedTouches))?e.changedTouches[0].pageX:(e.pageX?e.pageX:(e.x+B.body.scrollLeft)),G=(E||(isOPAPub()&&e.changedTouches))?e.changedTouches[0].pageY:(e.pageY?e.pageY:(e.y+B.body.scrollTop)),H=D?D.div:B.getElementById('wndPage'),I=triv$(H).offset();if(I){F-=Math.round(I.left);G-=Math.round(I.top);};return {x:F,y:G};};function DynMouseDown(x,y) {return true;};function DynMouseMove(x,y) {return true;};function DynMouseUp(x,y) {return true;};dragMgr=new DragMgr();
